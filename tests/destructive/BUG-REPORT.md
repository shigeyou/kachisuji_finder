# 破壊的テスト バグレポート

**実施日時**: 2025-01-28
**対象環境**: https://kachisuji-finder.azurewebsites.net
**テスト実行者**: Claude Code

---

## テスト概要

| テストスイート | テスト数 | 成功 | 失敗 | クラッシュ |
|--------------|---------|------|------|----------|
| 境界値破壊テスト | 16 | 16 | 0 | 0 |
| 状態破壊テスト | 13 | 12 | 1 | 1 |
| ネットワーク破壊テスト | 12 | 12 | 0 | 0 |
| AI機能破壊テスト | 9 | 9 | 0 | 0 |
| ストレステスト | 3 | 3 | 0 | 0 |
| ファズテスト | 5 | 5 | 0 | 0 |
| **合計** | **58** | **57** | **1** | **1** |

---

## クリティカルバグ

### BUG-001: SWOT再分析ボタン連打でブラウザクラッシュ

| 項目 | 内容 |
|------|------|
| **重要度** | Critical |
| **テストID** | SD-003 |
| **発見日** | 2025-01-28 |
| **ステータス** | Open |

#### 再現手順

```
1. https://kachisuji-finder.azurewebsites.net にアクセス
2. SWOTタブをクリック
3. SWOT再分析ボタンを10回以上高速で連打
4. ブラウザ/ページがクラッシュする
```

#### 期待される動作

- ボタン連打時はdebounceまたはdisable処理により、複数リクエストを防止
- 処理中はボタンがdisabled状態になる

#### 実際の動作

- 複数のAPI呼び出しが同時に発生
- メモリまたはリソース枯渇によりページがクラッシュ
- エラーメッセージ: `Target page, context or browser has been closed`

#### 推奨修正

```typescript
// src/components/SwotSection.tsx または該当コンポーネント

const [isAnalyzing, setIsAnalyzing] = useState(false);

const handleReanalyze = async () => {
  if (isAnalyzing) return; // 二重実行防止

  setIsAnalyzing(true);
  try {
    await analyzeSwot();
  } finally {
    setIsAnalyzing(false);
  }
};

<button
  onClick={handleReanalyze}
  disabled={isAnalyzing}
>
  {isAnalyzing ? '分析中...' : '再分析'}
</button>
```

#### エビデンス

- スクリーンショット: `test-results/destructive-artifacts/sd-003-swot-mash.png`
- トレース: `test-results/destructive-artifacts/state-destruction-状態破壊テスト---ボタン連打-SD-003-SWOT再分析ボタンを10回連打-state-destruction/`

---

## 中程度のバグ

### BUG-002: タブ切替後に入力内容が保持されない

| 項目 | 内容 |
|------|------|
| **重要度** | Medium |
| **テストID** | SD-008 |
| **発見日** | 2025-01-28 |
| **ステータス** | Open |

#### 再現手順

```
1. 勝ち筋探索タブでテキストを入力
2. 別のタブ（SWOT等）に切り替え
3. 勝ち筋探索タブに戻る
4. 入力内容が消えている
```

#### 期待される動作

- タブ切替後も入力内容が保持される
- または、入力内容が消えることを警告する

#### 推奨修正

- React Context または localStorage で入力状態を保持
- または、タブ切替時に確認ダイアログを表示

---

### BUG-003: ネットワークエラー時のユーザーフィードバックが不十分

| 項目 | 内容 |
|------|------|
| **重要度** | Medium |
| **テストID** | ND-012 |
| **発見日** | 2025-01-28 |
| **ステータス** | Open |

#### 再現手順

```
1. ネットワークを切断または不安定な状態にする
2. 探索を開始ボタンをクリック
3. エラーメッセージが表示されない、または不明確
```

#### 期待される動作

- 「ネットワークエラーが発生しました。接続を確認してください」等のユーザーフレンドリーなメッセージ
- リトライボタンの提供

#### 推奨修正

```typescript
try {
  await exploreApi();
} catch (error) {
  if (error.name === 'TypeError' && error.message.includes('fetch')) {
    toast.error('ネットワークエラーが発生しました。接続を確認してください。');
  } else {
    toast.error(`エラーが発生しました: ${error.message}`);
  }
}
```

---

## 軽微な問題

### OBS-001: ランダム操作時のコンソールエラー

| 項目 | 内容 |
|------|------|
| **重要度** | Low |
| **テストID** | FZ-003, FZ-005 |
| **発見日** | 2025-01-28 |
| **ステータス** | Observation |

#### 詳細

- ファズテスト中に23〜53件のコンソールエラーが発生
- クラッシュは発生せず、アプリケーションは動作継続
- エラーの多くは予期せぬ状態遷移による警告レベル

#### 推奨対応

- 本番環境では問題なし
- 必要に応じてエラーログを分析し、警告を抑制

---

## テスト結果サマリー

### 強度テスト結果

| テスト項目 | 実行回数 | 結果 |
|-----------|---------|------|
| タブ切替 | 200回 | 合格（メモリ増加3MB） |
| モーダル開閉 | 100回 | 合格 |
| ランダム入力 | 500ケース | 合格 |
| ランダム入力 | 2000ケース | 合格 |
| ランダム操作 | 500回 | 合格（エラー23件、クラッシュ0） |
| 並列実行 | 10ブラウザ | 合格（エラー53件、クラッシュ0） |
| APIファズ | 100回 | 合格 |

### 特記事項

1. **メモリリーク**: 200回のタブ切替で約3MBのメモリ増加を確認。長時間使用では影響の可能性あり
2. **パフォーマンス**: 連続操作でのパフォーマンス劣化は検出されず
3. **セキュリティ**: SQLインジェクション、XSS等の攻撃パターンに対して脆弱性は検出されず

---

## 推奨アクション

### 優先度: 高
1. **BUG-001** の修正: SWOTボタンにdebounce/disabled処理を追加

### 優先度: 中
2. **BUG-002** の修正: タブ切替時の入力保持機能を追加
3. **BUG-003** の修正: ネットワークエラー時のユーザーフィードバックを改善

### 優先度: 低
4. コンソールエラーの調査と必要に応じた修正

---

## テスト環境

- **Playwright バージョン**: 1.51.0
- **ブラウザ**: Chromium
- **認証**: Azure AD (MOLMAT-EO_DIVGM グループ)
- **テスト実行時間**: 約45分

---

## 添付ファイル

- `test-results/destructive-artifacts/` - スクリーンショット、トレース、動画
- `tests/destructive/` - テストコード
- `playwright.destructive.config.ts` - テスト設定
