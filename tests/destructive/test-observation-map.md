# 破壊的テスト観点マップ

## 対象アプリケーション
- **名称**: 勝ち筋ファインダー
- **URL**: https://kachisuji-finder.azurewebsites.net
- **認証**: Azure AD (MOLMAT-EO_DIVGMグループ限定)
- **技術スタック**: Next.js, Prisma, Azure OpenAI, Turso DB

## 画面/機能分解

| タブ | 機能 | 入力点 | 外部I/O | 致命度 |
|------|------|--------|---------|--------|
| はじめに | 説明表示 | なし | なし | 低 |
| 対象企業 | 企業情報設定 | テキスト入力 | DB保存 | 中 |
| RAG情報 | ドキュメント管理 | ファイルアップロード | DB保存、ファイル処理 | **高** |
| SWOT | SWOT分析表示/再生成 | ボタン | Azure OpenAI API | **高** |
| スコア設定 | スコア基準設定 | スライダー6個 | DB保存 | 中 |
| 勝ち筋探索 | AI探索実行 | テーマ入力、制約入力 | Azure OpenAI API | **最高** |
| ランキング | 戦略一覧 | なし | DB読取 | 低 |
| シン・勝ち筋 | 進化/自動探索 | ボタン | Azure OpenAI API | **高** |
| インサイト | メタ分析 | ボタン | Azure OpenAI API | **高** |
| 探索履歴 | 履歴表示 | なし | DB読取 | 低 |

## 破壊ポイント設計

### 1. 勝ち筋探索（最高優先度）

| 壊し方 | 入力 | 期待される失敗モード |
|--------|------|---------------------|
| 空入力 | テーマ="" | エラー表示 or 無視 |
| 極端に長い入力 | 10万文字 | タイムアウト、メモリ逼迫 |
| 特殊文字 | 絵文字、RTL、結合文字 | 文字化け、パース失敗 |
| SQLインジェクション風 | ' OR 1=1 -- | 無害化されるか |
| HTMLインジェクション | <script>alert(1)</script> | XSS |
| 二重送信 | 探索ボタン連打 | 二重実行、DB不整合 |
| 途中キャンセル | 探索中にリロード | 中断処理、不整合 |
| 同時探索 | 2タブで同時実行 | 競合、データ破壊 |

### 2. SWOT再分析（高優先度）

| 壊し方 | 操作 | 期待される失敗モード |
|--------|------|---------------------|
| 連打 | 再分析ボタン10連打 | 二重実行、リソース枯渇 |
| 途中キャンセル | 分析中にタブ切替 | 不完全データ |
| RAGなしで実行 | RAGドキュメント0件時 | エラー処理 |

### 3. RAGドキュメント（高優先度）

| 壊し方 | 入力 | 期待される失敗モード |
|--------|------|---------------------|
| 巨大ファイル | 100MB PDF | タイムアウト、メモリ |
| 0バイトファイル | 空ファイル | エラー処理 |
| 拡張子偽装 | .exe→.pdf | セキュリティ |
| 破損ファイル | 壊れたPDF | パース失敗 |
| 同名ファイル連続 | 同じ名前で複数回 | 上書き/重複 |
| 削除中のアクセス | 削除しながら参照 | 競合 |

### 4. ネットワーク破壊

| 壊し方 | 条件 | 期待される失敗モード |
|--------|------|---------------------|
| 遅延注入 | 5秒遅延 | タイムアウト処理 |
| 500エラー注入 | 10%の確率 | エラーリカバリー |
| 接続断 | オフライン化 | 状態保持、復帰処理 |
| タイムアウト | 30秒以上 | UI凍結、エラー表示 |

### 5. 状態破壊

| 壊し方 | 操作 | 期待される失敗モード |
|--------|------|---------------------|
| 戻るボタン連打 | 操作中に戻る | 状態不整合 |
| リロード連打 | F5連打 | セッション破壊 |
| タブ複製 | 同一操作を2箇所で | 競合 |
| Enter連打 | フォーム送信中 | 二重送信 |

## 優先テスト（今日の破壊E2E 10本）

1. **探索二重送信** - 探索ボタン10連打
2. **探索極長入力** - 10万文字のテーマ
3. **探索途中リロード** - AI処理中にF5
4. **SWOT連打** - 再分析ボタン連打
5. **タブ複製同時探索** - 2タブで同時実行
6. **ネットワーク遅延** - 5秒遅延を注入
7. **500エラー注入** - APIに10%で500返却
8. **入力途中離脱** - 入力中にタブ切替→戻る
9. **データ削除中参照** - 削除と同時にアクセス
10. **長時間連続操作** - 同一フロー100回連続
